#!/bin/bash

# ะญะบัััะตะฝะฝะฐั ะพัะธััะบะฐ ะฟะฐะผััะธ ะดะปั macOS
# ะัะฟะพะปัะทัะตััั ะบะพะณะดะฐ ัะธััะตะผะฐ ะฟะพะบะฐะทัะฒะฐะตั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะพ ะฝะตัะฒะฐัะบะต ะฟะฐะผััะธ

echo "๐จ ะญะะกะขะะะะะะฏ ะะงะะกะขะะ ะะะะฏะขะ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะฆะฒะตัะฐ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# 1. ะััะฐะฝะพะฒะบะฐ ะทะฐะฒะธััะธั ะฟัะพัะตััะพะฒ Next.js
echo "1๏ธโฃ  ะััะฐะฝะพะฒะบะฐ ะทะฐะฒะธััะธั ะฟัะพัะตััะพะฒ Next.js..."
BUILD_PIDS=$(ps aux | grep "next build" | grep -v grep | awk '{print $2}')
if [ -n "$BUILD_PIDS" ]; then
    echo "$BUILD_PIDS" | xargs kill -9 2>/dev/null
    echo -e "${GREEN}โ ะััะฐะฝะพะฒะปะตะฝะพ ะฟัะพัะตััะพะฒ: $(echo "$BUILD_PIDS" | wc -l | tr -d ' ')${NC}"
else
    echo -e "${GREEN}โ ะะฐะฒะธััะธั ะฟัะพัะตััะพะฒ ะฝะต ะฝะฐะนะดะตะฝะพ${NC}"
fi

# 2. ะัะธััะบะฐ ะบะตัะฐ Next.js
echo ""
echo "2๏ธโฃ  ะัะธััะบะฐ ะบะตัะฐ Next.js..."
if [ -d ".next" ]; then
    rm -rf .next
    echo -e "${GREEN}โ ะะตั .next ะพัะธัะตะฝ${NC}"
fi
if [ -d "node_modules/.cache" ]; then
    rm -rf node_modules/.cache
    echo -e "${GREEN}โ ะะตั node_modules ะพัะธัะตะฝ${NC}"
fi

# 3. ะัะธััะบะฐ ัะธััะตะผะฝัั ะบะตัะตะน
echo ""
echo "3๏ธโฃ  ะัะธััะบะฐ ัะธััะตะผะฝัั ะบะตัะตะน..."
purge 2>/dev/null && echo -e "${GREEN}โ ะกะธััะตะผะฝัะต ะบะตัะธ ะพัะธัะตะฝั${NC}" || echo -e "${YELLOW}โ๏ธ  purge ะฝะต ะดะพัััะฟะตะฝ${NC}"

# 4. ะัะธััะบะฐ ะบะตัะตะน ะฟัะธะปะพะถะตะฝะธะน
echo ""
echo "4๏ธโฃ  ะัะธััะบะฐ ะบะตัะตะน ะฟัะธะปะพะถะตะฝะธะน..."
rm -rf ~/Library/Caches/* 2>/dev/null | head -20
echo -e "${GREEN}โ ะะตัะธ ะฟัะธะปะพะถะตะฝะธะน ะพัะธัะตะฝั${NC}"

# 5. ะัะธััะบะฐ ะปะพะณะพะฒ
echo ""
echo "5๏ธโฃ  ะัะธััะบะฐ ััะฐััั ะปะพะณะพะฒ..."
find ~/Library/Logs -type f -mtime +7 -delete 2>/dev/null
echo -e "${GREEN}โ ะกัะฐััะต ะปะพะณะธ ัะดะฐะปะตะฝั${NC}"

# 6. ะัะธััะบะฐ Trash
echo ""
echo "6๏ธโฃ  ะัะธััะบะฐ ะบะพัะทะธะฝั..."
rm -rf ~/.Trash/* 2>/dev/null
echo -e "${GREEN}โ ะะพัะทะธะฝะฐ ะพัะธัะตะฝะฐ${NC}"

# 7. ะะฝัะพัะผะฐัะธั ะพ ะฟัะพัะตััะฐั Cursor
echo ""
echo "7๏ธโฃ  ะะฝะฐะปะธะท ะฟัะพัะตััะพะฒ Cursor..."
CURSOR_MEM=$(ps aux | grep -i cursor | grep -v grep | awk '{sum+=$6} END {print int(sum/1024)}')
echo -e "${YELLOW}๐ Cursor ะฟะพััะตะฑะปัะตั: ${CURSOR_MEM} MB${NC}"

if [ "$CURSOR_MEM" -gt 2000 ]; then
    echo -e "${RED}โ๏ธ  ะะะะขะะงะะ! Cursor ะฟะพััะตะฑะปัะตั ะฑะพะปััะต 2GB ะฟะฐะผััะธ!${NC}"
    echo -e "${YELLOW}๐ก ะะตะบะพะผะตะฝะดะฐัะธั: ะะตัะตะทะฐะฟัััะธัะต Cursor${NC}"
    echo ""
    read -p "ะะตัะตะทะฐะฟัััะธัั Cursor ัะตะนัะฐั? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        killall Cursor 2>/dev/null
        echo -e "${GREEN}โ Cursor ะฟะตัะตะทะฐะฟััะตะฝ${NC}"
        echo -e "${YELLOW}๐ก ะะพะดะพะถะดะธัะต 10 ัะตะบัะฝะด ะธ ะพัะบัะพะนัะต Cursor ะทะฐะฝะพะฒะพ${NC}"
    fi
fi

# 8. ะะฝัะพัะผะฐัะธั ะพ ะฟะฐะผััะธ
echo ""
echo "8๏ธโฃ  ะขะตะบััะตะต ัะพััะพัะฝะธะต ะฟะฐะผััะธ:"
vm_stat | grep -E "Pages free|Pages active|Pages inactive" | head -3

# 9. ะะตะบะพะผะตะฝะดะฐัะธะธ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo -e "${GREEN}โ ะญะะกะขะะะะะะฏ ะะงะะกะขะะ ะะะะะะจะะะ${NC}"
echo ""
echo "๐ก ะะะะะะะะะะฆะะ:"
echo "   1. ะะตัะตะทะฐะฟัััะธัะต Cursor (ะฟะพััะตะฑะปัะตั ${CURSOR_MEM} MB)"
echo "   2. ะะฐะบัะพะนัะต ะฝะตะธัะฟะพะปัะทัะตะผัะต ะฒะบะปะฐะดะบะธ ะฒ Cursor"
echo "   3. ะัะบะปััะธัะต ะฝะตะธัะฟะพะปัะทัะตะผัะต ัะฐััะธัะตะฝะธั"
echo "   4. ะะฐะบัะพะนัะต Telegram ะธ ะดััะณะธะต ััะถะตะปัะต ะฟัะธะปะพะถะตะฝะธั"
echo "   5. ะะตัะตะทะฐะณััะทะธัะต Mac ะตัะปะธ ะฟัะพะฑะปะตะผะฐ ัะพััะฐะฝัะตััั"
echo ""
