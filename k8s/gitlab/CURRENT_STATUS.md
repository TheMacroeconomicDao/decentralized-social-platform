# üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã GitLab –∏ Kubernetes –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: $(date)

## ‚úÖ –ß—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. GitLab Self-Hosted
- ‚úÖ **–†–∞–∑–≤–µ—Ä–Ω—É—Ç –≤ Kubernetes**: namespace `gitlab`
- ‚úÖ **–ü–æ–¥**: –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Ingress**: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è https://gitlab.gyber.org
- ‚úÖ **Root –ø–∞—Ä–æ–ª—å**: –ø–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- ‚úÖ **PVC**: —Å–æ–∑–¥–∞–Ω (50 Gi –¥–ª—è –¥–∞–Ω–Ω—ã—Ö)

### 2. Kubernetes –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **Namespace gitlab-runner**: —Å–æ–∑–¥–∞–Ω
- ‚úÖ **Secrets**: —Å–æ–∑–¥–∞–Ω—ã –≤ `default` –∏ `gitlab-runner` namespaces
- ‚úÖ **.gitlab-ci.yml**: —Å–æ–∑–¥–∞–Ω —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –¥–ª—è stage –∏ prod

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ **–ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã**: `k8s/gitlab/gitlab-deployment.yaml`
- ‚úÖ **–°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: —Å–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. GitLab Personal Access Token
- ‚ùå **–¢–æ–∫–µ–Ω –Ω–µ —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- üí° **–†–µ—à–µ–Ω–∏–µ**: —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - URL: https://gitlab.gyber.org/-/user_settings/personal_access_tokens
  - –õ–æ–≥–∏–Ω: `root`
  - –ü–∞—Ä–æ–ª—å: `73/sV+RgIpHNd9Go7w0SJoTGJoLvl71P3NwUDh2nUUk=`
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å: `echo '—Ç–æ–∫–µ–Ω' > k8s/gitlab/.gitlab-token`

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚ùå **–ù–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω)
- üí° **–†–µ—à–µ–Ω–∏–µ**: –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å `./k8s/gitlab/setup-env-now.sh`

### 3. –ü—Ä–æ–µ–∫—Ç –≤ GitLab
- ‚ùå **–ù–µ —Å–æ–∑–¥–∞–Ω** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω)
- üí° **–†–µ—à–µ–Ω–∏–µ**: —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ API –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

### 4. Git Remote
- ‚ùå **–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–µ–∫—Ç)
- üí° **–†–µ—à–µ–Ω–∏–µ**: –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ç–æ–∫–µ–Ω–∞:
  ```bash
  git remote add gitlab https://oauth2:${GITLAB_TOKEN}@gitlab.gyber.org/root/decentralized-social-platform.git
  ```

### 5. CI/CD –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ GitLab
- ‚ùå **–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç—É)
- üí° **–†–µ—à–µ–Ω–∏–µ**: –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Settings ‚Üí CI/CD ‚Üí Variables:
  - `GHCR_USERNAME`
  - `GHCR_TOKEN`
  - `KUBE_CONFIG`
  - `KUBE_CONTEXT`

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω (5 –º–∏–Ω—É—Ç)
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://gitlab.gyber.org
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ root
3. –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: `echo '—Ç–æ–∫–µ–Ω' > k8s/gitlab/.gitlab-token`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (1 –º–∏–Ω—É—Ç–∞)
```bash
./k8s/gitlab/setup-env-now.sh
source ~/.zshrc
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ GitLab (2 –º–∏–Ω—É—Ç—ã)
–ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ API

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å git remote (1 –º–∏–Ω—É—Ç–∞)
```bash
git remote add gitlab https://oauth2:${GITLAB_TOKEN}@gitlab.gyber.org/root/decentralized-social-platform.git
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (5 –º–∏–Ω—É—Ç)
–í GitLab: Settings ‚Üí CI/CD ‚Üí Variables

### –®–∞–≥ 6: –ó–∞–ø—É—à–∏—Ç—å –∫–æ–¥ (2 –º–∏–Ω—É—Ç—ã)
```bash
git push gitlab main
```

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `k8s/gitlab/gitlab-deployment.yaml` - –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã Kubernetes
- `k8s/gitlab/values.yaml` - Helm values (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ GitLab)
- `.gitlab-ci.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CI/CD

### –°–∫—Ä–∏–ø—Ç—ã
- `k8s/gitlab/get-root-password.sh` - –ø–æ–ª—É—á–µ–Ω–∏–µ root –ø–∞—Ä–æ–ª—è
- `k8s/gitlab/setup-env-now.sh` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `k8s/gitlab/setup-gitlab-repo.sh` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `k8s/gitlab/setup-k8s-integration.sh` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes
- `k8s/gitlab/create-token-automated.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `k8s/gitlab/README.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `k8s/gitlab/QUICK_START.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `k8s/gitlab/MANUAL_SETUP.md` - —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- `k8s/gitlab/QUICK_ENV_SETUP.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- `k8s/gitlab/SECRETS_SETUP.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å GitLab
kubectl get pods -n gitlab

# –ü–æ–ª—É—á–∏—Ç—å root –ø–∞—Ä–æ–ª—å
./k8s/gitlab/get-root-password.sh

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞)
./k8s/gitlab/setup-env-now.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
cat k8s/gitlab/.gitlab-token

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
echo $GITLAB_URL
echo $GITLAB_TOKEN
```

## üéØ –ò—Ç–æ–≥

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**: 70%
- ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (5 –º–∏–Ω—É—Ç)
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (5 –º–∏–Ω—É—Ç)

**–í—Ä–µ–º—è –¥–æ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**: ~15 –º–∏–Ω—É—Ç —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã

