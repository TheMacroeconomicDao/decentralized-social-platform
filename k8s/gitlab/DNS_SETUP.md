# üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –¥–ª—è GitLab

## –ü—Ä–æ–±–ª–µ–º–∞

GitLab —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞, –Ω–æ –¥–æ–º–µ–Ω `gitlab.gyber.org` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ DNS, –ø–æ—ç—Ç–æ–º—É:
- ‚ùå –î–æ–º–µ–Ω –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è
- ‚ùå SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–¥–∞–Ω (Let's Encrypt –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–º–µ–Ω)
- ‚ùå –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –¥–æ–º–µ–Ω—É

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–∏ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å—å —Ç–∏–ø–∞ **A** –¥–ª—è –¥–æ–º–µ–Ω–∞ `gitlab.gyber.org`:

```
–¢–∏–ø: A
–ò–º—è: gitlab (–∏–ª–∏ @ –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞)
–ó–Ω–∞—á–µ–Ω–∏–µ: 65.108.15.30
TTL: 300 (–∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å:**
- –ï—Å–ª–∏ –¥–æ–º–µ–Ω `gyber.org` —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–æ–º–µ–Ω–æ–≤ (GoDaddy, Namecheap, Cloudflare –∏ —Ç.–¥.)
- –ò–ª–∏ —á–µ—Ä–µ–∑ DNS —Å–µ—Ä–≤–µ—Ä –≤–∞—à–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–æ–±—ã—á–Ω–æ 5-15 –º–∏–Ω—É—Ç)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `dig gitlab.gyber.org` –∏–ª–∏ `nslookup gitlab.gyber.org`
3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cert-manager
4. GitLab —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ https://gitlab.gyber.org

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ /etc/hosts (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ /etc/hosts
./k8s/gitlab/fix-dns-temporary.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
sudo sh -c 'echo "65.108.15.30 gitlab.gyber.org" >> /etc/hosts'
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- ‚ö†Ô∏è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω (Let's Encrypt –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–º–µ–Ω)
- ‚ö†Ô∏è –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ HTTP (–Ω–µ HTTPS)

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
sudo sed -i.bak '/gitlab.gyber.org/d' /etc/hosts
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ dig
dig gitlab.gyber.org

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ nslookup
nslookup gitlab.gyber.org

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ host
host gitlab.gyber.org

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: 65.108.15.30
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∏ –≤—ã–¥–∞—á–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
kubectl get certificate -n gitlab gitlab-tls

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å READY: True

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–∞–ª–∏
kubectl describe certificate -n gitlab gitlab-tls
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GitLab

```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./k8s/gitlab/check-gitlab-domain.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl
curl -I https://gitlab.gyber.org

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTTP 200 –∏–ª–∏ 302
```

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ GitLab —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ Ingress –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ IP –∞–¥—Ä–µ—Å: 65.108.15.30
- ‚ùå DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚ùå SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≤—ã–¥–∞–Ω (–æ–∂–∏–¥–∞–µ—Ç DNS)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å—å A** –¥–ª—è `gitlab.gyber.org -> 65.108.15.30`
2. **–ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS** (5-15 –º–∏–Ω—É—Ç)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS**: `dig gitlab.gyber.org`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**: `kubectl get certificate -n gitlab gitlab-tls`
5. **–û—Ç–∫—Ä–æ–π—Ç–µ GitLab**: https://gitlab.gyber.org
6. **–í–æ–π–¥–∏—Ç–µ**: root / `73/sV+RgIpHNd9Go7w0SJoTGJoLvl71P3NwUDh2nUUk=`
7. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω** –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

