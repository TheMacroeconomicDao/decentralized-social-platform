# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ GitLab

## –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Permissions-Policy –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `Unrecognized feature: 'interest-cohort'`
- `Unrecognized feature: 'browsing-topics'`

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**: –ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ GitLab

### 2. API 502 –æ—à–∏–±–∫–∞
- `POST https://gyber.org/lab/api/v4/usage_data/track_event 502 (Bad Gateway)`

**–ü—Ä–∏—á–∏–Ω–∞**: 
- Puma (Rails —Å–µ—Ä–≤–µ—Ä) –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É—Ç–∏ –Ω–∞ `/lab`

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```bash
./k8s/gitlab/fix-gitlab-api.sh
```

### –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
```bash
kubectl exec -n gitlab $(kubectl get pods -n gitlab -l app=gitlab -o jsonpath='{.items[0].metadata.name}') -- \
  gitlab-ctl reconfigure
```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Puma –∏ Workhorse**:
```bash
kubectl exec -n gitlab $(kubectl get pods -n gitlab -l app=gitlab -o jsonpath='{.items[0].metadata.name}') -- \
  gitlab-ctl restart puma gitlab-workhorse
```

3. **–ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã** –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**:
```bash
curl -I https://gyber.org/lab/api/v4/version
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP 200 –∏–ª–∏ 401)
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ –ù–µ—Ç 502 –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚ö†Ô∏è Permissions-Policy –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Permissions-Policy –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- 502 –æ—à–∏–±–∫–∏ –Ω–∞ API endpoints –Ω–æ—Ä–º–∞–ª—å–Ω—ã –≤ –ø–µ—Ä–≤—ã–µ –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- GitLab –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–∞ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏



