#!/bin/bash
set -e

echo "üîß –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ gitlab.gyber.org –≤ /etc/hosts"
echo ""

GITLAB_IP="65.108.15.30"
HOSTS_FILE="/etc/hosts"
HOST_ENTRY="$GITLAB_IP gitlab.gyber.org"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å—å
if grep -q "gitlab.gyber.org" "$HOSTS_FILE" 2>/dev/null; then
    echo "‚ö†Ô∏è  –ó–∞–ø–∏—Å—å –¥–ª—è gitlab.gyber.org —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ /etc/hosts"
    echo ""
    echo "–¢–µ–∫—É—â–∞—è –∑–∞–ø–∏—Å—å:"
    grep "gitlab.gyber.org" "$HOSTS_FILE"
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å? (y/n) " -n 1 -r
    echo ""
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å
        sudo sed -i.bak '/gitlab.gyber.org/d' "$HOSTS_FILE"
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
        echo "$HOST_ENTRY" | sudo tee -a "$HOSTS_FILE" > /dev/null
        echo "‚úÖ –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞"
    else
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        exit 0
    fi
else
    echo "‚ûï –î–æ–±–∞–≤–ª—è—é –∑–∞–ø–∏—Å—å –≤ /etc/hosts..."
    echo "$HOST_ENTRY" | sudo tee -a "$HOSTS_FILE" > /dev/null
    echo "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞"
fi

echo ""
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "‚úÖ DNS –í–†–ï–ú–ï–ù–ù–û –ù–ê–°–¢–†–û–ï–ù"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞!"
echo "   –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å—å A:"
echo "   gitlab.gyber.org -> $GITLAB_IP"
echo ""
echo "üåê –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å:"
echo "   http://gitlab.gyber.org (–±–µ–∑ SSL, –ø–æ–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≥–æ—Ç–æ–≤)"
echo "   –∏–ª–∏"
echo "   https://gitlab.gyber.org (–ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞)"
echo ""
echo "üí° –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —É–¥–∞–ª–∏—Ç–µ –∑–∞–ø–∏—Å—å –∏–∑ /etc/hosts:"
echo "   sudo sed -i.bak '/gitlab.gyber.org/d' /etc/hosts"
echo ""

