# GitLab Configuration для self-hosted deployment
# Упрощенная конфигурация для быстрого старта

global:
  hosts:
    domain: gitlab.gyber.org
    gitlab:
      name: gitlab.gyber.org
    externalIP: 65.108.15.30
  
  ingress:
    configureCertmanager: true
    class: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
      traefik.ingress.kubernetes.io/router.tls: "true"
      cert-manager.io/cluster-issuer: letsencrypt-prod

# Cert-manager issuer
certmanager-issuer:
  email: themacroeconomicdao@proton.me

# GitLab компоненты
gitlab:
  webservice:
    replicas: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "1Gi"
        cpu: "500m"
  
  sidekiq:
    replicas: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "250m"

  toolbox:
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "250m"

# PostgreSQL
postgresql:
  install: true
  persistence:
    size: 10Gi
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "250m"

# Redis
redis:
  install: true
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "100m"

# Gitaly
gitaly:
  persistence:
    size: 20Gi
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "250m"

# Отключаем ненужные компоненты
registry:
  enabled: false

global:
  minio:
    enabled: false
  
  # Отключаем object storage, используем локальное хранилище
  appConfig:
    artifacts:
      bucket: ""
    lfs:
      bucket: ""
    uploads:
      bucket: ""
    packages:
      bucket: ""

# Отключаем backups в toolbox (или настроим позже)
gitlab:
  toolbox:
    backups:
      objectStorage:
        config:
          secret: ""
          key: ""

prometheus:
  install: false

grafana:
  install: false

